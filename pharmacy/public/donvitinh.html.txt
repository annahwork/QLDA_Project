<!doctype html><html lang="vi"><head>
<meta charset="utf-8"><title>Đơn vị tính</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head><body class="p-4">
<h3>Quản lý Đơn vị tính</h3>
<div class="row g-2 mb-3">
  <div class="col-auto"><input id="tendvt" class="form-control" placeholder="Tên đơn vị"></div>
  <div class="col-auto"><button class="btn btn-primary" onclick="add()">Thêm</button></div>
</div>
<table class="table table-striped" id="tbl"><thead><tr><th>Mã</th><th>Tên</th><th></th></tr></thead><tbody></tbody></table>
<script>
const API='../api/donvitinh.php';
async function load(){ const r=await fetch(API); const j=await r.json();
  const tb=document.querySelector('#tbl tbody'); tb.innerHTML='';
  j.data.forEach(x=>tb.insertAdjacentHTML('beforeend',`
    <tr><td>${x.madvt}</td>
    <td><input id="u${x.madvt}" class="form-control form-control-sm" value="${x.tendvt}"></td>
    <td><button class="btn btn-sm btn-success" onclick="save(${x.madvt})">Lưu</button>
        <button class="btn btn-sm btn-danger" onclick="del(${x.madvt})">Xóa</button></td></tr>`));
}
async function add(){ const tendvt=document.getElementById('tendvt').value.trim(); if(!tendvt) return;
  await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tendvt})});
  document.getElementById('tendvt').value=''; load();}
async function save(madvt){ const tendvt=document.getElementById('u'+madvt).value.trim();
  await fetch(API,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({madvt,tendvt})}); load();}
async function del(madvt){ if(!confirm('Xóa?'))return; await fetch(API+'?madvt='+madvt,{method:'DELETE'}); load();}
load();
</script></body></html>
